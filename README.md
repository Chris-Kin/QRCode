> A QRCode generator built by javascript  

# QR二维码编码过程解析
二维码分很多种，本文仅讨论QRCode。  
大体上，QRCode的编码过程分四步：  
1. 数据分析
2. 数据编码
3. 纠错码编码
4. 结构化数据编码与纠错码
5. 生成矩阵
6. 掩码
7. 添加格式与版本信息

下文我们对以上步骤逐一讲解

## 数据分析
待编码数据分为四类：
- 数字
- 字母
- 字节
- Kanji

每种格式的数据都有特定的编码规则，将待编码数据转换成尽可能短的二进制字符串。当然混合编码模式是存在的。

## 数据编码

### 选择纠错级别

| 纠错级别 | 纠错水平 |
| :-------------: |:-------------:|
| L | 7% |
| M | 15% |
| Q | 25% |
| H | 30% |

注意，纠错级别越高，要包含的纠错字节也就越多，导致二维码越大。

### 选择二维码版本
QRCode有四十个版本 v1~v40，对应的大小为21x21 ~ 177x177。不同版本所能承载的最大字符串（包含纠错码）长度不同。
[各个版本最大承载字符串长度](http://www.thonky.com/qr-code-tutorial/character-capacities
)  
给定待编码字符和纠错级别后，对照该表格即可确定二维码版本  
### 生成所选编码模式信息
```
  Numeric: '0001',
  Alphanumeric: '0010',
  Byte: '0100',
  Kanji: '1000',
  ECI: '0111',
```
### 添加待编码字符长度信息，紧随模式信息后面
用多少位二进制来表示字符长度信息，是由二维码版本和编码模式共同决定的 [戳这里](http://www.thonky.com/qr-code-tutorial/data-encoding)  

### 对字符本身进行编码,生成01
四种编码模式对应四种算法： [戳这里](http://www.thonky.com/qr-code-tutorial/alphanumeric-mode-encoding)  

### 级联上面三步骤的结果，并补足长度

QR码规范要求二进制串必须完全填充QR码的总容量，因此这里需要对以上结果做补码操作。二进制长度是由version and error correction level共同决定的（和编码模式无关）,所以一共40x4=160种码长 [戳这里](http://www.thonky.com/qr-code-tutorial/error-correction-table) 注意表格中长度单位是字节，需要转化为位.
步骤：
- 右侧补0，直到长度到达总容量，**但是最多补4个**
- 如果上步之后长度仍然不够总容量，右侧补0至总长度为8的倍数
- 如果上步之后还不够，右侧补充'11101100 00010001',直到到达总容量
